{% extends "base.html" %}
{% block title %}Kavak Trade-Up - Main Dashboard{% endblock %}
{% block content %}
    <header class="main-header">
        <h2>ðŸ“ˆ Main Dashboard</h2>
        <p>30,000-Foot View of Portfolio Potential <span id="config-status-badge" class="status-badge" style="display:none;"></span></p>
    </header>

    <div id="dashboard-scenario-summary" class="kpi-grid" style="display:none; margin-bottom:2rem;"></div>

    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-value">{{ "{:,.0f}".format(metrics.total_customers) }}</div>
            <div class="kpi-label">Total Eligible Customers</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value">{{ "{:,.0f}".format(metrics.total_offers) }}</div>
            <div class="kpi-label">Total Potential Offers</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value">${{ "{:,.0f}".format(metrics.avg_npv) }}</div>
            <div class="kpi-label">Average NPV per Offer</div>
        </div>
         <div class="kpi-card">
            <div class="kpi-value">{{ "{:,.1f}".format(metrics.avg_offers_per_customer) }}</div>
            <div class="kpi-label">Avg. Offers per Customer</div>
        </div>
    </div>

    <div class="chart-grid">
        <div class="chart-container">
            <h3>Offer Distribution by Tier</h3>
            <canvas id="tierChart"></canvas>
        </div>
        <div class="chart-container">
            <h3>Top 10 Most "Offerable" Cars</h3>
            <canvas id="topCarsChart"></canvas>
        </div>
    </div>
{% endblock %}
{% block extra_js %}
<script>
    const tierData = {{ metrics.tier_distribution | tojson }};
    const topCarsData = {{ metrics.top_cars | tojson }};

    // Tier Distribution Chart
    new Chart(document.getElementById('tierChart'), {
        type: 'doughnut',
        data: {
            labels: Object.keys(tierData),
            datasets: [{
                label: 'Offers by Tier',
                data: Object.values(tierData),
                backgroundColor: ['#60A5FA', '#34D399', '#FBBF24'],
                borderColor: '#FFFFFF',
                borderWidth: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                }
            }
        }
    });

    // Top Cars Chart
    new Chart(document.getElementById('topCarsChart'), {
        type: 'bar',
        data: {
            labels: topCarsData.map(c => c.Model),
            datasets: [{
                label: 'Estimated Customer Matches',
                data: topCarsData.map(c => c.Estimated_Matches),
                backgroundColor: '#A5B4FC',
                borderColor: '#6366F1',
                borderWidth: 2
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                x: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
{% endblock %}
