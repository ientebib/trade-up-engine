{% extends "base.html" %}
{% block title %}Kavak Trade-Up - Engine Configuration{% endblock %}
{% block content %}
    <header class="main-header">
        <h2>‚öôÔ∏è Engine Configuration</h2>
        <p>Select a mode, tune parameters, and run analysis.</p>
    </header>

    <!-- Current Status Banner -->
    <div id="config-status-banner" class="config-status-banner">
        <div class="status-icon"></div>
        <div>
            <h4 id="config-status-title">Loading Status...</h4>
            <p id="config-status-message">Fetching current engine configuration.</p>
        </div>
    </div>

    <!-- Engine Mode Selection -->
    <div class="section-card">
        <h3>Engine Mode</h3>
        <div class="config-mode-selection">
            <label class="config-mode-card" for="mode-default">
                <input type="radio" id="mode-default" name="engine-mode" value="default" checked>
                <div class="mode-content">
                    <h4>üìä Default Mode</h4>
                    <p>Hierarchical search using predefined fee levels.</p>
                    <small>Fees: Service (5%/0%), CXA (4%/0%), CAC ($0/$5k)</small>
                </div>
            </label>
            <label class="config-mode-card" for="mode-custom">
                <input type="radio" id="mode-custom" name="engine-mode" value="custom">
                <div class="mode-content">
                    <h4>üéõÔ∏è Custom Parameters</h4>
                    <p>Set specific, fixed fee values for all calculations.</p>
                    <small>Ideal for testing a known configuration.</small>
                </div>
            </label>
            <label class="config-mode-card" for="mode-range">
                <input type="radio" id="mode-range" name="engine-mode" value="range">
                <div class="mode-content">
                    <h4>üéØ Range Optimization</h4>
                    <p>Test all parameter combinations within a defined range.</p>
                    <small>Discover optimal fee structures via brute-force.</small>
                </div>
            </label>
        </div>
    </div>

    <!-- Custom Parameters Section -->
    <div id="custom-config-section" class="config-section" style="display: none;">
        <div class="section-card">
            <h3>Custom Fee Structure</h3>
            <div class="form-grid-three">
                <div class="form-group">
                    <label class="form-label" for="custom-service-fee">Service Fee (%)</label>
                    <div class="range-slider">
                        <input type="range" id="custom-service-fee" min="0" max="5" step="0.1" value="5">
                        <span class="range-slider-value">5.0%</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="custom-cxa-fee">CXA Fee (%)</label>
                    <div class="range-slider">
                        <input type="range" id="custom-cxa-fee" min="0" max="4" step="0.1" value="4">
                        <span class="range-slider-value">4.0%</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="custom-cac-bonus">CAC Bonus (MXN)</label>
                    <div class="range-slider">
                        <input type="range" id="custom-cac-bonus" min="0" max="10000" step="500" value="5000">
                        <span class="range-slider-value">$5,000</span>
                    </div>
                </div>
            </div>
            <div class="form-divider"></div>
            <div class="form-grid-three">
                <div class="form-group">
                    <label class="form-label" for="custom-insurance">Insurance (MXN)</label>
                    <input type="number" id="custom-insurance" class="form-input" value="10999" step="100">
                </div>
                <div class="form-group">
                    <label class="form-label" for="custom-gps-install">GPS Install (MXN)</label>
                    <input type="number" id="custom-gps-install" class="form-input" value="750" step="50">
                </div>
                <div class="form-group">
                    <label class="form-label" for="custom-gps-monthly">GPS Monthly (MXN)</label>
                    <input type="number" id="custom-gps-monthly" class="form-input" value="350" step="10">
                </div>
            </div>
        </div>
    </div>

    <!-- Range Optimization Section -->
    <div id="range-config-section" class="config-section" style="display: none;">
        <div class="section-card">
            <h3>Range Optimization Parameters</h3>
            <div class="form-grid-three">
                <div class="range-param-card">
                    <h4>Service Fee (%)</h4>
                    <div class="form-grid-three-condensed">
                        <input type="number" id="range-service-fee-min" class="form-input" value="0" step="0.1" placeholder="Min">
                        <input type="number" id="range-service-fee-max" class="form-input" value="5" step="0.1" placeholder="Max">
                        <input type="number" id="range-service-fee-step" class="form-input" value="0.5" step="0.01" placeholder="Step">
                    </div>
                    <div class="range-count-display"><span id="service-fee-count">11</span> values</div>
                </div>
                <div class="range-param-card">
                    <h4>CXA Fee (%)</h4>
                    <div class="form-grid-three-condensed">
                        <input type="number" id="range-cxa-fee-min" class="form-input" value="0" step="0.1" placeholder="Min">
                        <input type="number" id="range-cxa-fee-max" class="form-input" value="4" step="0.1" placeholder="Max">
                        <input type="number" id="range-cxa-fee-step" class="form-input" value="0.5" step="0.01" placeholder="Step">
                    </div>
                    <div class="range-count-display"><span id="cxa-fee-count">9</span> values</div>
                </div>
                <div class="range-param-card">
                    <h4>CAC Bonus (MXN)</h4>
                    <div class="form-grid-three-condensed">
                        <input type="number" id="range-cac-bonus-min" class="form-input" value="0" step="500" placeholder="Min">
                        <input type="number" id="range-cac-bonus-max" class="form-input" value="10000" step="500" placeholder="Max">
                        <input type="number" id="range-cac-bonus-step" class="form-input" value="1000" step="100" placeholder="Step">
                    </div>
                <div class="range-count-display"><span id="cac-bonus-count">11</span> values</div>
                </div>
            </div>
            <div class="form-group" style="margin-top: 1rem;">
                <label class="form-label" for="range-search-method">Search Method</label>
                <select id="range-search-method" class="form-input">
                    <option value="exhaustive">Exhaustive Search</option>
                    <option value="smart">Smart Search</option>
                </select>
            </div>
            <div id="range-summary-banner" class="range-summary-banner">
                Total Combinations: <strong id="total-combinations">1,089</strong>
                <div id="performance-warning" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="config-actions">
        <button id="save-config-btn" class="btn-primary">Save Configuration</button>
        <button id="run-analysis-btn" class="btn-secondary">Run Full Analysis</button>
        <button id="reset-config-btn" class="btn-tertiary">Reset to Defaults</button>
    </div>

    <!-- Simple Loading Modal for blocking actions -->
    <div id="config-loading-modal" class="loading-modal" style="display: none;">
        <div class="loading-modal-content">
            <div class="spinner"></div>
            <h3 id="loading-modal-title">Processing...</h3>
            <p id="loading-modal-message">Please wait.</p>
        </div>
    </div>
{% endblock %}
{% block extra_js %}
<script>
    // This script block should only contain the initialization call
    // All substantive logic will be moved to /static/js/main.js
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof initializeConfigPage === 'function') {
            initializeConfigPage();
        }
    });
</script>
{% endblock %}
